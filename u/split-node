#!/usr/bin/env raku

my %file-map = %(
=begin comment
    "bitcoin-node/src/bdb.rs"                        => "bitcoin-bdb",
    "bitcoin-node/src/bitcoin_wallet.rs"             => "bitcoin-wallet",
    "bitcoin-node/src/blockchain.rs"                 => "bitcoinrpc-blockchain",
    "bitcoin-node/src/blockstorage.rs"               => "bitcoin-block",
    "bitcoin-node/src/coin.rs"                       => "bitcoin-coinselect",
    "bitcoin-node/src/coincontrol.rs"                => "bitcoin-coincontrol",
    "bitcoin-node/src/coinselection.rs"              => "bitcoin-coinselect",
    "bitcoin-node/src/coinstats.rs"                  => "bitcoin-coincontrol",
    "bitcoin-node/src/crypter.rs"                    => "bitcoin-crypter",
    "bitcoin-node/src/db.rs"                         => "bitcoin-walletdb",
    "bitcoin-node/src/dummywallet.rs"                => "bitcoin-dummywallet",
    "bitcoin-node/src/dump.rs"                       => "bitcoin-dumpwallet",
    "bitcoin-node/src/external.rs"                   => "bitcoin-signingprovider",
    "bitcoin-node/src/external_signer.rs"            => "bitcoin-signingprovider",
    "bitcoin-node/src/feebumper.rs"                  => "bitcoinwallet-fees",
    "bitcoin-node/src/fees.rs"                       => "bitcoinwallet-fees",
    #"bitcoin-node/src/imports.rs"                    => "",
    "bitcoin-node/src/init.rs"                       => "bitcoinwallet-init",
    "bitcoin-node/src/interfaces.rs"                 => "bitcoinwallet-interface",
    "bitcoin-node/src/key_io.rs"                     => "bitcoin-key",
    #"bitcoin-node/src/lib.rs"                        => "",
    "bitcoin-node/src/libdb_hook.rs"                 => "bitcoin-db",
    "bitcoin-node/src/load.rs"                       => "bitcoinwallet-init",
    "bitcoin-node/src/mining.rs"                     => "bitcoinrpc-mining",
    "bitcoin-node/src/misc.rs"                       => "bitcoinrpc-misc",
    "bitcoin-node/src/net.rs"                        => "bitcoinrpc-net",
    "bitcoin-node/src/node_context.rs"               => "bitcoinnode-context",
    "bitcoin-node/src/psbt.rs"                       => "bitcoin-psbt",
    "bitcoin-node/src/rawtransaction.rs"             => "bitcoinrpc-txn",
    "bitcoin-node/src/rawtransaction_util.rs"        => "bitcoinrpc-txn",
    "bitcoin-node/src/receive.rs"                    => "bitcoinwallet-receive",
    "bitcoin-node/src/register.rs"                   => "bitcoin-rpc",
    "bitcoin-node/src/rpcdump.rs"                    => "bitcoinrpc-dump",
    "bitcoin-node/src/rpcwallet.rs"                  => "bitcoinrpc-wallet",
    "bitcoin-node/src/salvage.rs"                    => "bitcoinwallet-salvage",
    "bitcoin-node/src/scriptpubkeyman.rs"            => "bitcoin-scriptpubkeyman",
    "bitcoin-node/src/scriptpubkeyman_legacy.rs"     => "bitcoin-scriptpubkeyman",
    "bitcoin-node/src/server.rs"                     => "bitcoinrpc-server",
    "bitcoin-node/src/spend.rs"                      => "bitcoinwallet-spend",
    "bitcoin-node/src/sqlite_if.rs"                  => "bitcoin-sqlite",
    "bitcoin-node/src/test_coinselector_tests.rs"    => "bitcoin-test",
    "bitcoin-node/src/test_crypto_tests.rs"          => "bitcoin-test",
    "bitcoin-node/src/test_db_tests.rs"              => "bitcoin-test",
    "bitcoin-node/src/test_init_tests.rs"            => "bitcoin-test",
    "bitcoin-node/src/test_ismine_tests.rs"          => "bitcoin-test",
    "bitcoin-node/src/test_psbt_tests.rs"            => "bitcoin-test",
    "bitcoin-node/src/test_scriptpubkeyman_tests.rs" => "bitcoin-test",
    "bitcoin-node/src/test_spend_tests.rs"           => "bitcoin-test",
    "bitcoin-node/src/test_test_fixture.rs"          => "bitcoin-test",
    "bitcoin-node/src/test_tests.rs"                 => "bitcoin-test",
    "bitcoin-node/src/test_util.rs"                  => "bitcoin-test",
    "bitcoin-node/src/test_walletdb_tests.rs"        => "bitcoin-test",
    "bitcoin-node/src/transaction.rs"                => "bitcoinwallet-txn",
    "bitcoin-node/src/util.rs"                       => "bitcoinrpc-util",
    "bitcoin-node/src/wallet_context.rs"             => "bitcoin-wallet",
    "bitcoin-node/src/walletdb.rs"                   => "bitcoin-wallet",
    "bitcoin-node/src/walletinitinterface.rs"        => "bitcoin-wallet",
    "bitcoin-node/src/wallettool.rs"                 => "bitcoin-wallet",
    "bitcoin-node/src/walletutil.rs"                 => "bitcoin-wallet",

    "bitcoin-secp256k1/src/asm_field_10x26_arm.s"                 => "bitcoinsecp256k1-field",
    "bitcoin-secp256k1/src/bench.rs"                              => "bitcoinsecp256k1-bench",
    "bitcoin-secp256k1/src/bench_ecdh.rs"                         => "bitcoinsecp256k1-bench",
    "bitcoin-secp256k1/src/bench_ecmult.rs"                       => "bitcoinsecp256k1-bench",
    "bitcoin-secp256k1/src/bench_internal.rs"                     => "bitcoinsecp256k1-bench",
    "bitcoin-secp256k1/src/bench_recover.rs"                      => "bitcoinsecp256k1-bench",
    "bitcoin-secp256k1/src/bench_schnorrsig.rs"                   => "bitcoinsecp256k1-bench",
    "bitcoin-secp256k1/src/bench_sign.rs"                         => "bitcoinsecp256k1-bench",
    "bitcoin-secp256k1/src/bench_verify.rs"                       => "bitcoinsecp256k1-bench",
    "bitcoin-secp256k1/src/contrib_lax_der_parsing.rs"            => "bitcoinsecp256k1-parse",
    "bitcoin-secp256k1/src/contrib_lax_der_privatekey_parsing.rs" => "bitcoinsecp256k1-parse",
    "bitcoin-secp256k1/src/ecdh.rs"                               => "bitcoinsecp256k1-ec",
    "bitcoin-secp256k1/src/ecdsa.rs"                              => "bitcoinsecp256k1-ec",
    "bitcoin-secp256k1/src/eckey.rs"                              => "bitcoinsecp256k1-ec",
    "bitcoin-secp256k1/src/ecmult.rs"                             => "bitcoinsecp256k1-ec",
    "bitcoin-secp256k1/src/ecmult_const.rs"                       => "bitcoinsecp256k1-ec",
    "bitcoin-secp256k1/src/ecmult_gen.rs"                         => "bitcoinsecp256k1-ec",
    "bitcoin-secp256k1/src/extrakeys.rs"                          => "bitcoinsecp256k1-keys",
    "bitcoin-secp256k1/src/field.rs"                              => "bitcoinsecp256k1-field",
    "bitcoin-secp256k1/src/field_10x26.rs"                        => "bitcoinsecp256k1-field",
    "bitcoin-secp256k1/src/field_5x52.rs"                         => "bitcoinsecp256k1-field",
    "bitcoin-secp256k1/src/group_impl.rs"                         => "bitcoinsecp256k1-group",
    "bitcoin-secp256k1/src/hash.rs"                               => "bitcoinsecp256k1-hash",
    "bitcoin-secp256k1/src/modinv32.rs"                           => "bitcoinsecp256k1-modinv",
    "bitcoin-secp256k1/src/modinv64.rs"                           => "bitcoinsecp256k1-modinv",
    "bitcoin-secp256k1/src/recovery.rs"                           => "bitcoinsecp256k1-recovery",
    "bitcoin-secp256k1/src/scalar.rs"                             => "bitcoinsecp256k1-scalar",
    "bitcoin-secp256k1/src/scalar_4x64.rs"                        => "bitcoinsecp256k1-scalar",
    "bitcoin-secp256k1/src/scalar_8x32.rs"                        => "bitcoinsecp256k1-scalar",
    "bitcoin-secp256k1/src/scalar_low.rs"                         => "bitcoinsecp256k1-scalar",
    "bitcoin-secp256k1/src/scalar_split_lambda.rs"                => "bitcoinsecp256k1-scalar",
    "bitcoin-secp256k1/src/schnorrsig.rs"                         => "bitcoinsecp256k1-schnorr",
    "bitcoin-secp256k1/src/scratch.rs"                            => "bitcoinsecp256k1-scratch",

    "bitcoin-net/src/addr.rs"             => "bitcoin-address",
    "bitcoin-net/src/blockencodings.rs"   => "bitcoin-blockencoding",
    "bitcoin-net/src/chain.rs"            => "bitcoin-chain",
    "bitcoin-net/src/chainparams.rs"      => "bitcoin-chain",
    "bitcoin-net/src/chainparamsseeds.rs" => "bitcoin-chain",
    "bitcoin-net/src/i2p.rs"              => "bitcoin-sam",
    "bitcoin-net/src/lookup.rs"           => "bitcoin-dns",
    "bitcoin-net/src/netaddr.rs"          => "bitcoin-netaddr",
    "bitcoin-net/src/netaddress.rs"       => "bitcoin-network",
    "bitcoin-net/src/netbase.rs"          => "bitcoin-proxy",
    "bitcoin-net/src/netmessagemaker.rs"  => "bitcoin-netmsg",
    "bitcoin-net/src/node_info.rs"        => "bitcoin-node",
    "bitcoin-net/src/node_txmit.rs"       => "bitcoin-node",
    "bitcoin-net/src/node_txrelay.rs"     => "bitcoin-node",
    "bitcoin-net/src/permissions.rs"      => "bitcoin-netpermissions",
    "bitcoin-net/src/protocol.rs"         => "bitcoin-netmsg",
    "bitcoin-net/src/service.rs"          => "bitcoin-service",
    "bitcoin-net/src/sock.rs"             => "bitcoin-sock",
    "bitcoin-net/src/subnet.rs"           => "bitcoin-subnet",
    "bitcoin-net/src/timedata.rs"         => "bitcoin-time",
    "bitcoin-net/src/url.rs"              => "bitcoin-url",
    "bitcoin-txmempool/src/coinsview_mempool.rs"          => "bitcoin-coinsview",
    "bitcoin-txmempool/src/entry.rs"                      => "bitcoin-blockpolicy",
    "bitcoin-txmempool/src/estimator.rs"                  => "bitcoin-blockpolicy",
    "bitcoin-txmempool/src/main_signals.rs"               => "bitcoin-mainsignals",
    "bitcoin-txmempool/src/packages.rs"                   => "bitcoin-packages",
    "bitcoin-txmempool/src/policy.rs"                     => "bitcoin-policy",
    "bitcoin-txmempool/src/rbf.rs"                        => "bitcoin-rbf",
=end comment
    "bitcoin-crypto/src/aes.rs"              => "bitcoin-aes",
    "bitcoin-crypto/src/chacha20.rs"         => "bitcoin-chacha",
    "bitcoin-crypto/src/chacha_poly_aead.rs" => "bitcoin-chacha",
    "bitcoin-crypto/src/ctaes.rs"            => "bitcoin-aes",
    "bitcoin-crypto/src/ctaes_bench.rs"      => "bitcoin-aes",
    "bitcoin-crypto/src/ctaes_test.rs"       => "bitcoin-aes",
    "bitcoin-crypto/src/hkdf_sha256_32.rs"   => "bitcoin-sha256",
    "bitcoin-crypto/src/hmac_sha256.rs"      => "bitcoin-sha256",
    "bitcoin-crypto/src/hmac_sha512.rs"      => "bitcoin-sha512",
    "bitcoin-crypto/src/keyorigin.rs"        => "bitcoin-key",
    "bitcoin-crypto/src/muhash.rs"           => "bitcoin-muhash",
    "bitcoin-crypto/src/poly1305.rs"         => "bitcoin-poly1305",
    "bitcoin-crypto/src/privkey.rs"          => "bitcoin-key",
    "bitcoin-crypto/src/pubkey.rs"           => "bitcoin-key",
    "bitcoin-crypto/src/ripemd160.rs"        => "bitcoin-ripemd",
    "bitcoin-crypto/src/sha1.rs"             => "bitcoin-sha1",
    "bitcoin-crypto/src/sha256.rs"           => "bitcoin-sha256",
    "bitcoin-crypto/src/sha256_avx2.rs"      => "bitcoin-sha256",
    "bitcoin-crypto/src/sha256_shani.rs"     => "bitcoin-sha256",
    "bitcoin-crypto/src/sha256_sse4.rs"      => "bitcoin-sha256",
    "bitcoin-crypto/src/sha256_sse41.rs"     => "bitcoin-sha256",
    "bitcoin-crypto/src/sha3.rs"             => "bitcoin-sha3",
    "bitcoin-crypto/src/sha512.rs"           => "bitcoin-sha512",
    "bitcoin-crypto/src/siphash.rs"          => "bitcoin-siphash",
);
        
for %file-map.keys -> $file {

    my $target-crate = %file-map{$file};

    die "no crate: $target-crate" if not $target-crate.IO.e;

    if $file.IO.e {

        my $target-file = $target-crate ~ "/src/{$file.IO.basename}";
        shell "mv $file $target-file";

    } else {
        say "no file: $file";
    }
}
